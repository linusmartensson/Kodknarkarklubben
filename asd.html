<script type=t id=v>attribute vec2 a;void main(){gl_Position=vec4(a*2.0-1.0,0.5,1.0);}</script><script type=t id=f>
precision mediump float; 
uniform vec2 res; 
uniform float t;

float d(vec3 pos){
	
	vec3 p = pos;

	pos.x = mod(pos.x,30.0)-15.0;
	pos.y = mod(pos.y,30.0)-15.0;
	pos.z = mod(pos.z,30.0)-15.0;



	float a = distance(pos, vec3(4.0,0.0,2.0)+sin(vec3(1.0,1.1,1.2)*t)*3.0)-3.0;
	float b = distance(pos, vec3(4.0,0.0,2.0)+sin(vec3(1.4,1.5,1.7)*t)*3.0)-3.0;
	float c = distance(pos, vec3(4.0,0.0,2.0)+sin(vec3(1.3,1.6,1.8)*t)*3.0)-3.0;
	float z = min(a,b);
	z = min(z,p.y+4.0);
	return z;
}

void main(){
	float l = 0.0;
	float tf = floor(t*0.25+10.0);
	vec3 o = vec3(0.0,0.0,-20.0+t*100.0);
	vec3 dir = vec3((gl_FragCoord.xy/res.xy*2.0-1.0)/vec2(res.y/res.x,1.0),1.0);

	dir = normalize(dir);


	float r = floor(t*0.25);
	float c = cos(r);
	float s = sin(r);
	dir.xz *= mat2(c, -s,
		       s, c);

	 r = floor(t*0.525);
	 c = cos(r);
	 s = sin(r);
	dir.zy *= mat2(c, -s,
		       s, c);



	vec3 pp = vec3(0.0);




	float j = 0.0;
	gl_FragColor = vec4(0.0,0.0,0.0,1.0);
	float dt = 1.0;
	for(int i=0;i<170;++i){
		if(dt < 0.05 || l > 350.0){
			continue;
		}
		j = float(i);
		pp = o+dir*l;
		dt = d(pp);
		l += dt*0.95;
		
	}
	if(dt < 0.1){
		gl_FragColor = mix(vec4(l/150.0,j/(j+10.0),1.0,1.0),vec2(0.8,1.0).xxxy, clamp(l/600.0,0.0,1.0));
	} else {
		gl_FragColor = vec2(0.8,1.0).xxxy;
	}

}
</script><div style="position:fixed;left:0;right:0;top:0;bottom:0;" ><canvas width=320 height=720 id=a style="width:100%;height:100%"/></div><script>
d=function(a){return document.getElementById(a)}
l=function(a){console.log(a)};
c=d("a")
g=c.getContext("webgl")
v=g.createBuffer()
k=g.ARRAY_BUFFER
g.bindBuffer(k, v)
g.bufferData(k, new Float32Array([0.0,0.0,1.0,0.0,0.0,1.0,1.0,1.0]), g.STATIC_DRAW)
g.enableVertexAttribArray(0)
p=g.createProgram()
t=function(a,b,c){f=g.createShader(b);g.shaderSource(f,c);g.compileShader(f);g.attachShader(a,f);return g.getShaderInfoLog(f)}
l("VERT:"+t(p,g.VERTEX_SHADER,d("v").textContent))
l("FRAG:"+t(p,g.FRAGMENT_SHADER,d("f").textContent))
l(g.getProgramInfoLog(p));
g.linkProgram(p);
g.useProgram(p);
g.vertexAttribPointer(0, 2, g.FLOAT, 0, 0, 0);
t=0
m=function(a){
g.uniform2f(g.getUniformLocation(p, "res"), g.drawingBufferWidth,g.drawingBufferHeight);
t=t||a
g.uniform1f(g.getUniformLocation(p, "t"), (a-t)/1000)
g.drawArrays(g.TRIANGLE_STRIP, 0, 4)
window.requestAnimationFrame(m)
}

m(0)</script>
